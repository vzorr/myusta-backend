image: node:18

pipelines:
  branches:
    dev:  # Change this to the branch you want to trigger deployment from
      - step:
          name: Deploy to Server via SSH
          caches:
            - node
          script:
            - echo "ðŸš€ Starting deployment..."
            - echo "$SSH_PRIVATE_KEY" > key.pem
            - chmod 600 key.pem

            # OPTIONAL: Add known_hosts if you want strict SSH
            # - ssh-keyscan -H your-server-ip >> ~/.ssh/known_hosts

            - ssh -v -o StrictHostKeyChecking=no -i key.pem root@47.254.134.96 '
                cd /root/myusta-backend &&
                git pull origin dev &&
                npm install &&
                pm2 restart usta-app || pm2 start src/index.js --name usta-app
